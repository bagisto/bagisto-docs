import{_ as i,a as s,o as e,ag as t}from"./chunks/framework.C2qfZH9T.js";const k=JSON.parse('{"title":"Configure Varnish","description":"","frontmatter":{},"headers":[],"relativePath":"performance/configure-varnish.md","filePath":"performance/configure-varnish.md","lastUpdated":1757603037000}'),n={name:"performance/configure-varnish.md"};function h(l,a,r,p,o,d){return e(),s("div",null,a[0]||(a[0]=[t(`<h1 id="configure-varnish" tabindex="-1">Configure Varnish <a class="header-anchor" href="#configure-varnish" aria-label="Permalink to &quot;Configure Varnish&quot;">​</a></h1><p>Bagisto introduces Varnish Cache integration to deliver lightning-fast page loading, improved SEO, scalability, and reduced server load for enhanced eCommerce performance.</p><p>Varnish acts as a reverse proxy and caches full HTML pages. When a request is made for a cached page, Varnish serves it directly without executing backend logic. This reduces database queries, template rendering, and other resource-intensive operations, resulting in faster page loads.</p><p>Varnish also supports ESI (Edge Side Includes) and AJAX-based dynamic views, allowing dynamic content (like carts, dropdowns, or login blocks) to load fresh while the rest of the page remains cached.</p><h2 id="how-to-enable-varnish-integration-in-bagisto" tabindex="-1">How to Enable Varnish Integration in Bagisto <a class="header-anchor" href="#how-to-enable-varnish-integration-in-bagisto" aria-label="Permalink to &quot;How to Enable Varnish Integration in Bagisto&quot;">​</a></h2><h3 id="install-the-package" tabindex="-1">Install the Package <a class="header-anchor" href="#install-the-package" aria-label="Permalink to &quot;Install the Package&quot;">​</a></h3><p>Install the package via Composer:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">composer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> require</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bagisto/bagisto-varnish</span></span></code></pre></div><h3 id="register-service-provider" tabindex="-1">Register Service Provider <a class="header-anchor" href="#register-service-provider" aria-label="Permalink to &quot;Register Service Provider&quot;">​</a></h3><p>Register the service provider in <code>bootstrap/providers.php</code>:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;providers&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Webkul\\Varnish\\Providers\\VarnishServiceProvider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span></code></pre></div><h3 id="publish-configuration" tabindex="-1">Publish Configuration <a class="header-anchor" href="#publish-configuration" aria-label="Permalink to &quot;Publish Configuration&quot;">​</a></h3><p>Publish assets and configuration:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vendor:publish</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --provider=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Webkul\\Varnish\\Providers\\VarnishServiceProvider&quot;</span></span></code></pre></div><h3 id="configure-alias" tabindex="-1">Configure Alias <a class="header-anchor" href="#configure-alias" aria-label="Permalink to &quot;Configure Alias&quot;">​</a></h3><p>Configure the alias in <code>config/varnish.php</code>:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;aliases&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;Varnish&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\Webkul\\Varnish\\Facades\\VarnishCache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span></code></pre></div><h2 id="full-page-cache-supported-pages" tabindex="-1">Full Page Cache Supported Pages <a class="header-anchor" href="#full-page-cache-supported-pages" aria-label="Permalink to &quot;Full Page Cache Supported Pages&quot;">​</a></h2><ul><li>Home Page</li><li>Category Page</li><li>Product Page</li><li>CMS Pages</li></ul><h2 id="varnish-server-configuration" tabindex="-1">Varnish Server Configuration <a class="header-anchor" href="#varnish-server-configuration" aria-label="Permalink to &quot;Varnish Server Configuration&quot;">​</a></h2><h3 id="install-varnish" tabindex="-1">Install Varnish <a class="header-anchor" href="#install-varnish" aria-label="Permalink to &quot;Install Varnish&quot;">​</a></h3><p>Install Varnish 6.x on your server.</p><h3 id="configure-vcl-file" tabindex="-1">Configure VCL File <a class="header-anchor" href="#configure-vcl-file" aria-label="Permalink to &quot;Configure VCL File&quot;">​</a></h3><p>Replace <code>/etc/varnish/default.vcl</code> with the provided file:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Varnish/vcls/6.0.vcl</span></span></code></pre></div><h3 id="restart-varnish" tabindex="-1">Restart Varnish <a class="header-anchor" href="#restart-varnish" aria-label="Permalink to &quot;Restart Varnish&quot;">​</a></h3><p>Restart Varnish:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> varnish</span></span></code></pre></div><h2 id="theme-integration" tabindex="-1">Theme Integration <a class="header-anchor" href="#theme-integration" aria-label="Permalink to &quot;Theme Integration&quot;">​</a></h2><h3 id="define-dynamic-views-fragments" tabindex="-1">Define Dynamic Views / Fragments <a class="header-anchor" href="#define-dynamic-views-fragments" aria-label="Permalink to &quot;Define Dynamic Views / Fragments&quot;">​</a></h3><p>In <code>config/esi_views.php</code>, define a key and its Blade view path:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;customer-desktop-dropdown&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;varnish::shop.components.layouts.header.desktop.customer-dropdown&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span></code></pre></div><p><strong>Configuration:</strong></p><ul><li><strong>Key</strong> → Used in ESI or AJAX call (<code>customer-desktop-dropdown</code>)</li><li><strong>Path</strong> → Full Blade view path (<code>varnish::...</code>)</li></ul><h3 id="esi-include" tabindex="-1">ESI Include <a class="header-anchor" href="#esi-include" aria-label="Permalink to &quot;ESI Include&quot;">​</a></h3><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">esi:include</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> src</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/esi?tag=customer-desktop-dropdown&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span></code></pre></div><p><strong>ESI Characteristics:</strong></p><ul><li>Injects content at the Varnish level (server-side)</li><li>Appears immediately on page load</li><li>May affect LCP/FCP if backend is slow</li></ul><h3 id="ajax-dynamic-view-recommended-for-lcp" tabindex="-1">AJAX Dynamic View (Recommended for LCP) <a class="header-anchor" href="#ajax-dynamic-view-recommended-for-lcp" aria-label="Permalink to &quot;AJAX Dynamic View (Recommended for LCP)&quot;">​</a></h3><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">x-varnish::dynamic-view</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> view</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;customer-desktop-dropdown&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span></code></pre></div><p><strong>AJAX Benefits:</strong></p><ul><li>Loads via AJAX after user interaction</li><li>Improves LCP/FCP</li><li>Ideal for non-critical dropdowns, modals, and menus</li></ul><h2 id="cache-control-headers" tabindex="-1">Cache-Control Headers <a class="header-anchor" href="#cache-control-headers" aria-label="Permalink to &quot;Cache-Control Headers&quot;">​</a></h2><h3 id="non-cacheable-routes" tabindex="-1">Non-Cacheable Routes <a class="header-anchor" href="#non-cacheable-routes" aria-label="Permalink to &quot;Non-Cacheable Routes&quot;">​</a></h3><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Cache-Control</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no-cache, no-store, must-revalidate</span></span></code></pre></div><h3 id="cacheable-routes" tabindex="-1">Cacheable Routes <a class="header-anchor" href="#cacheable-routes" aria-label="Permalink to &quot;Cacheable Routes&quot;">​</a></h3><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Cache-Control</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> public, max-age=604800, s-maxage=604800</span></span></code></pre></div><p><em>(Example: 7 days)</em></p><h3 id="middleware-for-cache-headers" tabindex="-1">Middleware for Cache Headers <a class="header-anchor" href="#middleware-for-cache-headers" aria-label="Permalink to &quot;Middleware for Cache Headers&quot;">​</a></h3><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Route</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">HomeController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;index&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">middleware</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;cache.response&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="clearing-cache-with-artisan-commands" tabindex="-1">Clearing Cache with Artisan Commands <a class="header-anchor" href="#clearing-cache-with-artisan-commands" aria-label="Permalink to &quot;Clearing Cache with Artisan Commands&quot;">​</a></h2><p>To clear Varnish cache using Artisan commands:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> varnish:purge</span></span></code></pre></div><ul><li>Clears all cache entries</li><li>Optionally, provide URLs to purge specific pages:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> varnish:purge</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --url=http://example.com</span></span></code></pre></div><p>Replace <code>http://example.com</code> with the URL you want to clear from cache.</p><h2 id="cache-invalidation" tabindex="-1">Cache Invalidation <a class="header-anchor" href="#cache-invalidation" aria-label="Permalink to &quot;Cache Invalidation&quot;">​</a></h2><h3 id="automatic-cache-purging" tabindex="-1">Automatic Cache Purging <a class="header-anchor" href="#automatic-cache-purging" aria-label="Permalink to &quot;Automatic Cache Purging&quot;">​</a></h3><p>The Varnish package automatically purges cache when:</p><ul><li>Products, categories, CMS pages, orders, reviews, refunds, or themes are updated</li></ul><h3 id="manual-cache-purging-in-code" tabindex="-1">Manual Cache Purging in Code <a class="header-anchor" href="#manual-cache-purging-in-code" aria-label="Permalink to &quot;Manual Cache Purging in Code&quot;">​</a></h3><p>You can trigger cache invalidation manually using:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VarnishCache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($urls);</span></span></code></pre></div>`,63)]))}const g=i(n,[["render",h]]);export{k as __pageData,g as default};
